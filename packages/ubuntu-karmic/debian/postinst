#!/bin/sh -e

# Source debconf module
. /usr/share/debconf/confmodule

# Identifies the point in the file at which debhelper will insert automatically 
# added snippets.
#DEBHELPER#

# An installation process can be roll backed in which case we don't want to do
# anything.
if [ "$1" != configure ]; then
	exit 0
fi

# Make sure the icon cache is deleted and recreated
gtk-update-icon-cache /usr/share/icons/hicolor/

# Prepare the notification that tells the user to restart Nautilus

UPDATENOTIFIERDIR=/var/lib/update-notifier/user.d

# Ask if the user would like to restart nautilus...
db_get rabbitvcs/rabbitvcs-restart-required

# Note that I tried something like using a boolean value in the debconf template
# coupled with this:
#
#if [ "$RET" = "true" ]; then
#    nautilus -q
#fi
#
# ...But of course, since we're running as root, this has no effect on the user
# instance of nautilus.

# FIXME: this only works after running apt-get update (so it doesn't when 
# somebody manually installs the Debian package using dpkg -i).
if [ -d $UPDATENOTIFIERDIR ]; then
	cp -f /usr/share/rabbitvcs/rabbitvcs-restart-required.update-notifier \
	    "$UPDATENOTIFIERDIR/rabbitvcs-restart-required"
fi
